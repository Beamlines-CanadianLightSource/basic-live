"use strict";function getPrecision(t,e){e=e||8;let a=(t[t.length-1]-t[0])/e;return Math.abs(Math.floor(Math.log10(a.toPrecision(1))||2))}function renderMarkdown(t){return(new showdown.Converter).makeHtml(t)}const figureTypes=["histogram","lineplot","barchart","scatterplot","pie","gauge","timeline","columnchart","heatmap"];let ColorSchemes={Live4:["#8f9f9a","#c56052","#9f6dbf","#a0b552"],Live8:["#073B4C","#06D6A0","#FFD166","#EF476F","#118AB2","#7F7EFF","#afc765","#78C5E7"],Live16:["#67aec1","#c45a81","#cdc339","#ae8e6b","#6dc758","#a084b6","#667ccd","#cd4f55","#805cd6","#cf622d","#a69e4c","#9b9795","#6db586","#c255b6","#073B4C","#FFD166"],Dark2:d3.schemeDark2,Set1:d3.schemeSet1,Set2:d3.schemeSet2,Set3:d3.scheme,Tableau10:d3.schemeTableau10},styleTemplate=_.template("<%= selector %> { <%= rules %> }"),contentTemplate=_.template('<div id="entry-<%= id %>" <% let style = entry.style || ""; %> class="section-entry <%= style %>" >   <% if ((entry.title) &! (entry.kind))  { %>       <h4><%= entry.title %></h4>   <% } %>   <% if (entry.description) { %>       <div class="description"><%= renderMarkdown(entry.description) %></div>   <% } %>   <% if ((entry.kind === "table") && (entry.data)) { %>       <%= tableTemplate({id: id, entry: entry}) %>   <% } else if (figureTypes.includes(entry.kind)) { %>       <figure id="figure-<%= entry.id || id %>" data-type="<%= entry.kind %>" data-chart=\'<%= JSON.stringify(entry) %>\' >       </figure>   <% }%>   <% if (entry.notes) { %>       <div class="notes"><%= renderMarkdown(entry.notes) %></div>   <% } %></div>'),sectionTemplate=_.template('<section id="section-<%= id %>" <% let style = section.style || "col-12"; %>       class="<%= style %>">       <%  if (section.title)  {%>       <h3 class="section-title col-12"><%= section.title %></h3>       <% } %>       <%  if (section.description)  {%>       <div class="description"><%= renderMarkdown(section.description) %></div>       <% } %>     <% _.each(section.content, function(entry, j){ %><%= contentTemplate({id: id+"-"+j, entry: entry}) %><% }); %></section>'),tableTemplate=_.template('<table id="table-<%= id %>" class="table table-sm table-hover"><% if (entry.title) { %>   <caption class="text-center"><%= entry.title %></caption><% } %><% if (entry.header.includes("row")) { %>   <thead><tr>       <% _.each(entry.data[0], function(cell, i){ %>       <th><%= cell %></th>       <% }); %>   </tr></thead><% } %><tbody><% _.each(entry.data, function(row, j){ %>   <% if ((!entry.header.includes("row")) || (j>0)) { %>       <tr>       <% _.each(row, function(cell, i){ %>           <% if (entry.header.includes("column") && (i==0)) { %>               <th><%= cell %></th>           <% } else { %>               <td><%= cell %></td>           <% } %>       <% }); %>       </tr>   <% } %><% }); %></tbody></table>'),NUM_TICKS=10;function drawXYChart(t,e,a,i="spline"){let n=[],r=[],l={},d=i,o={interpolation:{}},s={x:{},y:{},y2:{}},c=[],h=e.data.x[1],p=e.data.x[e.data.x.length-1],u=d3.scaleLinear().domain([h,p]),y=u.ticks(NUM_TICKS),m=function(t){return t},f=function(t){return t},x=2;switch(e.data["x-scale"]){case"time":m=function(t){return Date.parse(t)},s.x=$.extend(s.x,{type:"timeseries",tick:{format:e.data["time-format"],culling:{max:13}}});break;case"pow":case"inv-square":let t="pow"===e.data["x-scale"]?1:-1;m=d3.scalePow().exponent(2*t).domain([h,p]),f=m.invert,u.domain([m(h),m(p)]),y=u.ticks(NUM_TICKS),x=getPrecision(y),s.x=$.extend(s.x,{tick:{values:y,multiline:!1,format:t=>f(t).toFixed(x)}});break;case"log":m=d3.scaleLog().domain([h,p]),f=m.invert,u.domain([m(h),m(p)]),y=u.ticks(NUM_TICKS),x=getPrecision(y),s.x=$.extend(s.x,{tick:{values:y,multiline:!1,format:t=>f(t).toFixed(x)}});break;case"identity":s.x=$.extend(s.x,{type:"index",tick:{multiline:!1}});break;default:s.x=$.extend(s.x,{tick:{values:y,fit:!0,multiline:!1,format:t=>f(t).toFixed(x)}})}e.data["x-limits"]&&(s.x=$.extend(s.x,{min:m(e.data["x-limits"][0]),max:m(e.data["x-limits"][1]),padding:0})),e.data["y1-limits"]&&(s.y=$.extend(s.y,{min:e.data["y1-limits"][0],max:e.data["y1-limits"][1],padding:0})),e.data["y2-limits"]&&(s.y2=$.extend(s.y2,{min:e.data["y2-limits"][0],max:e.data["y2-limits"][1],padding:0})),["cardinal","basis","step","step-before","step-after"].includes(e.data.interpolation)&&(d="spline",o.interpolation.type=e.data.interpolation),$.each(e.data.x,(function(t,e){0===t?c.push(e):c.push(m(e))})),s.x.label=e.data["x-label"]||e.data.x[0],r.push(c),t.removeData("chart").removeAttr("data-chart"),$.each(e.data.y1,(function(t,a){r.push(a),l[a[0]]="y",n.push(a[0]),0===t&&(s.y.label=e.data["y1-label"]||a[0])})),$.each(e.data.y2,(function(t,a){r.push(a),l[a[0]]="y2",n.push(a[0]),s.y2.show=!0,0===t&&(s.y2.label=e.data["y2-label"]||a[0])}));let g=d3.scaleOrdinal().domain(n).range(a.scheme);$.each(n,(function(t,e){e in a.colors||(a.colors[e]=g(e))}));let w=c3.generate({bindto:`#${t.attr("id")}`,size:{width:a.width,height:a.height},data:{type:d,columns:r,colors:a.colors,axes:l,x:e.data.x[0]},spline:o,point:{show:e.data.x.length<15},axis:s,grid:{y:{show:!0}},onresize:function(){this.api.resize({width:t.width(),height:t.width()*a.height/a.width})}});e.data.annotations&&w.xgrids(e.data.annotations),t.data("c3-chart",w)}function drawBarChart(t,e,a){let i=[],n=[],r=[],l=("object"==typeof e.data.colors&&e.data.colors,function(t,e){return t});t.removeData("chart"),t.removeAttr("data-chart");if($.each(e.data.data[0],(function(t,a){t===e.data["color-by"]?r.push(t):t===e.data["x-label"]||i.push(t)})),e.data["color-by"]){let t=e.data["color-by"];$.each(e.data.data,(function(e,a){n.includes(a[t])||n.push(a[t])})),l=function(i,n){if("object"==typeof n){let i=e.data.data[n.index][t];return a.colors[i]}return i}}let d=d3.scaleOrdinal().domain(n.concat(i)).range(a.scheme);$.each(i,(function(t,e){e in a.colors||(a.colors[e]=d(e))}));let o={},s={},c={show:!!e.data.line,label:e.data.line};e.data.line&&(s[e.data.line]="line",o[e.data.line]="y2",e.data["line-limits"]&&(c=$.extend(c,{min:e.data["line-limits"][0],max:e.data["line-limits"][1],padding:0})));let h=c3.generate({bindto:`#${t.attr("id")}`,size:{width:a.width,height:a.height},data:{type:"bar",json:e.data.data,hide:r,color:l,colors:a.colors,keys:{x:e.data["x-label"],value:i},axes:e.data.line&&o||{},types:e.data.line&&s||{},groups:e.data.stack||[],order:null},grid:{y:{show:!0}},axis:{x:{type:"category",label:e.data["x-label"]},y2:c,rotated:a.horizontal||!1},legend:{hide:1===i.length},bar:{width:{ratio:.6}},padding:{bottom:20},onresize:function(){this.api.resize({width:t.width(),height:t.width()*a.height/a.width})}});e.data.annotations&&(a.horizontal?h.ygrids(e.data.annotations):h.xgrids(e.data.annotations)),t.data("c3-chart",h)}function drawHistogram(t,e,a){let i=e["y-scale"],n=e.data.data;t.removeData("chart"),t.removeAttr("data-chart");let r=c3.generate({bindto:`#${t.attr("id")}`,size:{width:a.width,height:a.height},data:{type:"bar",json:n,colors:{y:a.scheme[t.parent().index()]},keys:{x:"x",value:["y"]}},axis:{x:{tick:{fit:!1,count:10,format:t=>t.toFixed(1)}},y:{type:i}},legend:{hide:!0},grid:{y:{show:!0}},bar:{width:{ratio:.5}},onresize:function(){this.api.resize({width:t.width(),height:t.width()*a.height/a.width})}});t.data("c3-chart",r)}function drawPieChart(t,e,a){let i={},n=[],r={};t.removeData("chart"),t.removeAttr("data-chart"),$.each(e.data.data,(function(t,e){i[e.label]=e.value,n.push(e.label),r[e.label]=e.color||a.scheme[t]}));let l=c3.generate({bindto:`#${t.attr("id")}`,size:{width:a.width,height:a.height},data:{type:"pie",json:[i],colors:r,keys:{value:n}},onresize:function(){this.api.resize({width:t.width(),height:t.width()*a.height/a.width})}});t.data("c3-chart",l)}function drawScatterChart(t,e,a){drawXYChart(t,e,a,"scatter")}function drawLineChart(t,e,a){drawXYChart(t,e,a,"line")}function callout(t,e,a){if(!e)return t.style("display","none");t.attr("data-label")&&(e=`${e} - ${t.attr("data-label")}`),t.attr("data-label"),t.style("display",null).style("pointer-events","none").style("font","10px sans-serif");const i=t.selectAll("path").data([null]).join("path").attr("fill","var(--warning)").attr("stroke","black"),n=t.selectAll("text").data([null]).join("text").call((t=>t.selectAll("tspan").data((e+"").split(/\n/)).join("tspan").attr("x",0).attr("y",((t,e)=>1.1*e+"rem")).style("font-weight",((t,e)=>e?null:"bold")).text((t=>t)))),{x:r,y:l,width:d,height:o}=n.node().getBBox();n.attr("transform",`translate(${-d/2},${10-l})`),i.attr("d",`M${-d/2-10},5H-5l5,-5l5,5H${d/2+10}v${o+10}h-${d+20}z`)}function drawTimeline(t,e,a){let i=[],n=10,r=10,l=10,d=10,o=a.width-d-r,s=o/2;$.each(e.data,(function(t,e){i.includes(e.type)||i.push(e.type)})),i.sort();let c=d3.scaleOrdinal().domain(i).range(a.scheme),h=d3.timeline().size([o,150]).extent([e.start,e.end]).bandStart((t=>t.start)).bandEnd((t=>t.end)).padding(2)(e.data),p=d3.scaleLinear().domain([e.start,e.end]).range([0,o]),u=d3.axisBottom().scale(p).tickFormat(d3.timeFormat("%H:%M")),y=d3.select(`#${t.attr("id")}`).append("svg").attr("viewBox",`-${d} -${n} ${a.width} 240`).attr("class","w-100");y.selectAll("rect.event").data(h).enter().append("rect").attr("class","event").attr("x",(function(t){return t.start})).attr("x",(function(t){return t.start})).attr("y",(function(t){return t.y})).attr("height",(function(t){return t.dy})).attr("width",(function(t){return t.end-t.start})).attr("data-label",(t=>`${t.label}`)).attr("data-type",(t=>t.type)).attr("shape-rendering","geometricPrecision").style("fill",(t=>c(t.type))).style("stroke",(t=>c(t.type))).attr("pointer-events","all").on("mouseover",(function(){b.attr("data-label",$(this).data("label"))})).on("mouseout",(function(){b.attr("data-label",null)})),y.append("g").call(u).attr("transform","translate(0, 160)");let m=0,f=y.append("g"),x=f.selectAll(".legend").data(i).enter().append("g").attr("class","legend").attr("data-type",(function(t,e){return t})).attr("transform",(function(t,e){if(0===e)return m=t.length+80,"translate(0,0)";{let e=m;return m+=t.length+80,`translate(${e}, 0)`}})).on("mouseover",(function(){let t=$(this).data("type");y.selectAll(`rect.event:not([data-type="${t}"])`).style("opacity",.1)})).on("mouseout",(function(){y.selectAll("rect").style("opacity",1)}));x.append("rect").attr("x",0).attr("y",0).attr("width",10).attr("height",10).style("fill",(t=>c(t))),x.append("text").attr("x",20).attr("y",10).text((function(t,e){return t})).style("text-anchor","start").style("font-size","10");let g=s-m/2,w=240-l-30;f.attr("transform",`translate(${g}, ${w})`);const b=y.append("g");y.append("g").attr("class","mouse-cursor").append("path").attr("class","mouse-line").style("stroke","var(--warning)").style("stroke-width","1px").style("opacity","0").attr("pointer-events","none");y.on("mouseleave",(function(){d3.select(".mouse-line").style("opacity",0),b.call(callout,null)})).on("touchmove mousemove",(function(){const t=d3.mouse(this),e=d3.timeFormat("%H:%M %b %d, %Y")(p.invert(t[0]));t[1]<165?(d3.select(".mouse-line").style("opacity",1).attr("d",(function(){return`M ${t[0]}, 160, ${t[0]} 0`})),b.attr("transform",`translate(${t[0]}, 164)`).call(callout,e)):(d3.select(".mouse-line").style("opacity",0),b.call(callout,null))})),t.removeData("chart").removeAttr("data-chart"),window.onresize=function(){let e=o/t.width();y.selectAll("text").attr("transform",`scale(${e} ${e})`),y.selectAll("line").attr("stroke-width",`${e}px`)}}function drawHeatMap(t,e,a){const i=d3.hexbin();let n=10,r=10,l=10,d=10,o=a.width-d-r,s=a.height-l-n,c=e.data.x.shift(),h=e.data.y.shift(),p=(e.data.z[4].shift(),Math.min(e.data.x)),u=Math.max(e.data.x),y=Math.min(e.data.y),m=Math.max(e.data.y),f=d3.scaleQuantile().domain(e.data.z[4]).range(d3.range(0,1.002,.002)),x=e.data.x.length,g=e.data.y.length;i.size([o,s]);let w=d3.min([o/((x+.5)*Math.sqrt(3)),s/(1.5*(g+1/3))]),b=d3.scaleLinear().domain([m,y]).range([s,0]),v=d3.axisLeft().scale(b).label(h),$=d3.scaleLinear().domain([u,p]).range([0,o]),k=d3.axisBottom().scale($).label(c),C=d3.select(`#${t.attr("id")}`).append("svg").attr("viewBox",`-${d} -${n} ${a.width} ${s}`).attr("class","w-100");C.append("g").call(k),C.append("g").call(v);for(var M=[],z=0;z<g;z++)for(var A=0;A<x;A++){var S=w*A*Math.sqrt(3);z%2==1&&(S+=w*Math.sqrt(3)/2);var T=w*z*1.5;M.push([S,T])}let F=d3.select(`#${t.attr("id")}`).append("div").style("opacity",0).attr("class","tooltip").style("background-color","white").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px");C.append("g").selectAll(".hexagon").data(i(M)).enter().append("path").attr("class","hexagon").attr("d",(function(t){return"M"+t.x+","+t.y+i.hexagon()})).attr("stroke","white").attr("stroke-width","1px").attr("data-label",((t,a)=>`${M[a]}:${e.data.z[4][a]}`)).style("fill",(function(t){return d3.interpolateViridis(f(t))})).on("mouseover",(function(t){F.style("opacity",1),d3.select(this).style("stroke","black").style("opacity",1)})).on("mousemove",(function(t,a){F.html(`${M[a]}:${e.data.z[a]}`).style("left",d3.mouse(this)[0]+70+"px").style("top",d3.mouse(this)[1]+"px")})).on("mouseleave",(function(t){F.style("opacity",0),d3.select(this).style("stroke","none").style("opacity",.8)}))}!function(t){t.fn.liveReport=function(e){let a=t(this),i=t.extend({data:{}},e);a.addClass("report-viewer"),t.each(i.data.details,(function(t,e){a.append(sectionTemplate({id:t,section:e}))})),a.find("figure").each((function(){let e=t(this),a=e.data("chart"),i={width:e.width(),height:e.width()/(a.data["aspect-ratio"]||16/9),colors:{}};switch(Array.isArray(a.data.colors)?i.scheme=a.data.colors:"object"==typeof a.data.colors?(i.scheme=ColorSchemes.Live16,i.colors=a.data.colors):i.scheme=ColorSchemes[a.data.colors]||ColorSchemes.Live16,e.data("type")){case"barchart":i.horizontal=!0,drawBarChart(e,a,i);break;case"columnchart":drawBarChart(e,a,i);break;case"lineplot":drawLineChart(e,a,i);break;case"histogram":drawHistogram(e,a,i);break;case"pie":drawPieChart(e,a,i);break;case"scatterplot":drawScatterChart(e,a,i);break;case"timeline":drawTimeline(e,a,i);break;case"heatmap":drawHeatMap(e,a,i)}a.title?e.after(`<figcaption class="text-center">${a.title}</figcaption>`):e.after('<figcaption class="text-center"></figcaption>')}))}}(jQuery);